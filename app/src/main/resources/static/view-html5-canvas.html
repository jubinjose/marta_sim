<!DOCTYPE HTML>

<html>

<head>

    <style>
        #mycanvas {
            border: 1px solid red;
        }
    </style>
</head>

<body>
    <canvas id="mycanvas" width="800" height="800"></canvas>
</body>
<script>

    var canvas = document.getElementById("mycanvas");
    var ctx = canvas.getContext('2d');


    var stops = [{id:1},{id:2},{id:3},{id:4},{id:5},{id:6},{id:7},{id:8}];
    var buses = [{id:1,stop:3},{id:2,stop:5}, {id:7,stop:3}];

    function generateRandomPointsForStops(){

        var points = [];
        var genCount = 0;

        while(genCount < stops.length){
            var x = Math.floor(Math.random() * 700);
            if (x < 100) x+=100;
            var y = Math.floor(Math.random() * 700);
            if (y < 100) y+=100;
            var hasOtherPointNearby = false;
            for (var j = 0; j < points.length; j++) {
                var a = points[j].x - x;
                var b = points[j].y - y;
                dist = Math.sqrt( a*a + b*b );
                if (dist<100) {
                    hasOtherPointNearby = true;
                    break;
                }
            }
            
            if (hasOtherPointNearby) continue;
            points.push({x,y});
            genCount ++;
        }

        return points;
    }

    function drawStop(stop){
        ctx.strokeRect(stop.x,stop.y,45,25);
        ctx.fillText(stop.id, stop.x + 20, stop.y + 15);
    }

    function drawBuses(stop, shouldclear){
        if(shouldclear === undefined) {
            shouldclear = false;
        }

        var busX = stop.x;
        var busY = stop.y + 30;

        for (var i = 0; i < stop.buses.length; i++) {
            if (shouldclear == false){
                ctx.strokeRect(busX,busY,15,15);
                ctx.fillText(stop.buses[i].id, busX + 5, busY + 10);
            }
            else{
                ctx.clearRect(busX-1,busY-1,17,17);
            }
            busX += 20;     
        }
    }

    var generatedPoints = generateRandomPointsForStops();

    for (var j = 0; j < generatedPoints.length; j++) {
        stops[j].x = generatedPoints[j].x;
        stops[j].y = generatedPoints[j].y;
        stops[j].buses = []; 
    }

    for (var j = 0; j < buses.length; j++) {
        var stop = stops.find(s => s.id == buses[j].stop);
        stop.buses.push(buses[j])
    }

    for (var j = 0; j < stops.length; j++) {
            drawStop(stops[j]);
            drawBuses(stops[j]);
    }

    function moveBus(busid, fromstopid, tostopid){
        var fromstop = stops.find(s => s.id == fromstopid);
        var tostop = stops.find(s => s.id == tostopid);

        drawBuses(fromstop, true);
        drawBuses(tostop, true);

        fromstop.buses = fromstop.buses.filter(bus => bus.id != busid);
        tostop.buses.push(buses.find(b => b.id == busid));

        drawBuses(fromstop);
        drawBuses(tostop);
    }

</script>

</html>